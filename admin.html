<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - Brew Haven</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .admin-container {
      max-width: 1400px;
      margin: 40px auto;
      padding: 20px;
    }
    .admin-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      border-bottom: 2px solid #3e2723;
      padding-bottom: 10px;
    }
    .admin-tab {
      padding: 12px 24px;
      background: #f5f5f5;
      border: none;
      border-radius: 6px 6px 0 0;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
    }
    .admin-tab.active {
      background: #3e2723;
      color: white;
    }
    .admin-tab:hover {
      background: #5d4037;
      color: white;
    }
    .tab-content {
      display: none;
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .tab-content.active {
      display: block;
    }
    .controls {
      display: flex;
      gap: 15px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }
    .search-box {
      flex: 1;
      min-width: 250px;
      padding: 12px 20px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
    }
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
    }
    .btn-primary { background: #3e2723; color: white; }
    .btn-primary:hover { background: #5d4037; }
    .btn-success { background: #4CAF50; color: white; }
    .btn-success:hover { background: #45a049; }
    .btn-danger { background: #f44336; color: white; }
    .btn-danger:hover { background: #da190b; }
    .btn-warning { background: #FF9800; color: white; }
    .btn-warning:hover { background: #e68900; }
    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    .data-table thead {
      background: #3e2723;
      color: white;
    }
    .data-table th,
    .data-table td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    .data-table tbody tr:hover {
      background: #f5f5f5;
    }
    .data-table img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 8px;
    }
    .action-btns {
      display: flex;
      gap: 8px;
    }
    .action-btns button {
      padding: 6px 12px;
      font-size: 12px;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    .modal.active {
      display: flex;
    }
    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 12px;
      max-width: 600px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal-content h3 {
      margin-top: 0;
      color: #3e2723;
      margin-bottom: 20px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #333;
    }
    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
    }
    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }
    .form-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 25px;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .stat-card {
      background: linear-gradient(135deg, #3e2723 0%, #5d4037 100%);
      color: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .stat-card h3 {
      margin: 0 0 10px 0;
      font-size: 16px;
      opacity: 0.9;
    }
    .stat-card .value {
      font-size: 36px;
      font-weight: bold;
      margin: 0;
    }
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }
  </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
  <!-- HEADER -->
  <header>
    <div class="container header-inner">
      <a class="logo" href="index.html">
        <img src="logo.svg" alt="Brew Haven Logo" class="logo-image">
        Brew Haven
      </a>
      <button class="menu-toggle">Menu ‚ò∞</button>
      <nav>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="features.html">Features</a></li>
          <li><a href="products.html">Products</a></li>
          <li><a href="contact.html">Contact</a></li>
          <li><a class="active" href="admin.html">Admin</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="container">
      <h1>üîß Admin Dashboard</h1>
      <p>Manage your coffee shop - Products, Customers, and Messages</p>
    </div>
  </section>

  <!-- ADMIN PANEL -->
  <div class="admin-container">
    <!-- Tabs -->
    <div class="admin-tabs">
      <button class="admin-tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
      <button class="admin-tab" onclick="showTab('products')">üõçÔ∏è Products</button>
      <button class="admin-tab" onclick="showTab('customers')">üë• Customers</button>
      <button class="admin-tab" onclick="showTab('messages')">üí¨ Messages</button>
    </div>

    <!-- Dashboard Tab -->
    <div id="dashboard" class="tab-content active">
      <h2>Dashboard Overview</h2>
      <div class="stats-grid">
        <div class="stat-card">
          <h3>Total Products</h3>
          <p class="value" id="stat-products">0</p>
        </div>
        <div class="stat-card">
          <h3>Total Customers</h3>
          <p class="value" id="stat-customers">0</p>
        </div>
        <div class="stat-card">
          <h3>Total Messages</h3>
          <p class="value" id="stat-messages">0</p>
        </div>
      </div>
    </div>

    <!-- Products Tab -->
    <div id="products" class="tab-content">
      <h2>Products Management</h2>
      <div class="controls">
        <input type="text" id="product-search" class="search-box" placeholder="Search products...">
        <button class="btn btn-primary" onclick="openProductModal()">‚ûï Add Product</button>
        <button class="btn btn-success" onclick="loadProducts()">üîÑ Refresh</button>
      </div>
      <div id="products-table"></div>
    </div>

    <!-- Customers Tab -->
    <div id="customers" class="tab-content">
      <h2>Customers Management</h2>
      <div class="controls">
        <input type="text" id="customer-search" class="search-box" placeholder="Search customers...">
        <button class="btn btn-primary" onclick="openCustomerModal()">‚ûï Add Customer</button>
        <button class="btn btn-success" onclick="loadCustomers()">üîÑ Refresh</button>
      </div>
      <div id="customers-table"></div>
    </div>

    <!-- Messages Tab -->
    <div id="messages" class="tab-content">
      <h2>Messages Management</h2>
      <div class="controls">
        <input type="text" id="message-search" class="search-box" placeholder="Search messages...">
        <button class="btn btn-success" onclick="loadMessages()">üîÑ Refresh</button>
      </div>
      <div id="messages-table"></div>
    </div>
  </div>

  <!-- Product Modal -->
  <div id="product-modal" class="modal">
    <div class="modal-content">
      <h3 id="product-modal-title">Add New Product</h3>
      <form id="product-form">
        <input type="hidden" id="product-id">
        <div class="form-group">
          <label>Product Name *</label>
          <input type="text" id="product-name" required>
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea id="product-description"></textarea>
        </div>
        <div class="form-group">
          <label>Price (‚Ç±) *</label>
          <input type="number" id="product-price" step="0.01" required>
        </div>
        <div class="form-group">
          <label>Category *</label>
          <select id="product-category" required>
            <option value="Coffee">Coffee</option>
            <option value="Pastry">Pastry</option>
            <option value="Merch">Merch</option>
          </select>
        </div>
        <div class="form-group">
          <label>Image URL</label>
          <input type="text" id="product-image" placeholder="images/product.jpg">
        </div>
        <div class="form-group">
          <label>Tags (comma-separated)</label>
          <input type="text" id="product-tags" placeholder="Hot, Milk, Sweet">
        </div>
        <div class="form-actions">
          <button type="button" class="btn" onclick="closeProductModal()">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Product</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Customer Modal -->
  <div id="customer-modal" class="modal">
    <div class="modal-content">
      <h3 id="customer-modal-title">Add New Customer</h3>
      <form id="customer-form">
        <input type="hidden" id="customer-id">
        <div class="form-group">
          <label>Name *</label>
          <input type="text" id="customer-name" required>
        </div>
        <div class="form-group">
          <label>Email *</label>
          <input type="email" id="customer-email" required>
        </div>
        <div class="form-group">
          <label>Phone</label>
          <input type="tel" id="customer-phone">
        </div>
        <div class="form-group">
          <label>Loyalty Points</label>
          <input type="number" id="customer-points" value="0">
        </div>
        <div class="form-actions">
          <button type="button" class="btn" onclick="closeCustomerModal()">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Customer</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const API_BASE = window.location.origin;

    // Tab Management
    function showTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
      document.getElementById(tabName).classList.add('active');
      event.target.classList.add('active');
      
      if (tabName === 'products') loadProducts();
      if (tabName === 'customers') loadCustomers();
      if (tabName === 'messages') loadMessages();
      if (tabName === 'dashboard') loadDashboard();
    }

    // Dashboard
    async function loadDashboard() {
      try {
        const [products, customers, messages] = await Promise.all([
          fetch(`${API_BASE}/api/products`).then(r => r.json()),
          fetch(`${API_BASE}/api/customers`).then(r => r.json()),
          fetch(`${API_BASE}/api/messages`).then(r => r.json())
        ]);
        
        document.getElementById('stat-products').textContent = products.length;
        document.getElementById('stat-customers').textContent = customers.length;
        document.getElementById('stat-messages').textContent = messages.length;
      } catch (error) {
        console.error('Error loading dashboard:', error);
      }
    }

    // Products
    async function loadProducts() {
      try {
        const search = document.getElementById('product-search').value;
        const url = search ? `${API_BASE}/api/products?q=${encodeURIComponent(search)}` : `${API_BASE}/api/products`;
        const products = await fetch(url).then(r => r.json());
        
        const container = document.getElementById('products-table');
        if (products.length === 0) {
          container.innerHTML = '<div class="empty-state"><p>No products found</p></div>';
          return;
        }
        
        container.innerHTML = `
          <table class="data-table">
            <thead>
              <tr>
                <th>Image</th>
                <th>Name</th>
                <th>Category</th>
                <th>Price</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              ${products.map(p => `
                <tr>
                  <td><img src="${p.image || 'images/placeholder.jpg'}" alt="${p.name}"></td>
                  <td><strong>${p.name}</strong><br><small>${p.description || ''}</small></td>
                  <td>${p.category}</td>
                  <td>‚Ç±${p.price.toFixed(2)}</td>
                  <td>
                    <div class="action-btns">
                      <button class="btn btn-warning" onclick='editProduct(${JSON.stringify(p)})'>Edit</button>
                      <button class="btn btn-danger" onclick="deleteProduct('${p.id}')">Delete</button>
                    </div>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;
      } catch (error) {
        console.error('Error loading products:', error);
      }
    }

    function openProductModal(product = null) {
      const modal = document.getElementById('product-modal');
      const title = document.getElementById('product-modal-title');
      
      if (product) {
        title.textContent = 'Edit Product';
        document.getElementById('product-id').value = product.id;
        document.getElementById('product-name').value = product.name;
        document.getElementById('product-description').value = product.description || '';
        document.getElementById('product-price').value = product.price;
        document.getElementById('product-category').value = product.category;
        document.getElementById('product-image').value = product.image || '';
        document.getElementById('product-tags').value = (product.tags || []).join(', ');
      } else {
        title.textContent = 'Add New Product';
        document.getElementById('product-form').reset();
        document.getElementById('product-id').value = '';
      }
      
      modal.classList.add('active');
    }

    function closeProductModal() {
      document.getElementById('product-modal').classList.remove('active');
    }

    function editProduct(product) {
      openProductModal(product);
    }

    async function deleteProduct(id) {
      if (!confirm('Are you sure you want to delete this product?')) return;
      
      try {
        const response = await fetch(`${API_BASE}/api/products/${id}`, { method: 'DELETE' });
        if (response.ok) {
          alert('Product deleted successfully');
          loadProducts();
        }
      } catch (error) {
        console.error('Error:', error);
      }
    }

    document.getElementById('product-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const id = document.getElementById('product-id').value;
      const data = {
        name: document.getElementById('product-name').value,
        description: document.getElementById('product-description').value,
        price: parseFloat(document.getElementById('product-price').value),
        category: document.getElementById('product-category').value,
        image: document.getElementById('product-image').value,
        tags: document.getElementById('product-tags').value.split(',').map(t => t.trim()).filter(t => t)
      };
      
      try {
        const url = id ? `${API_BASE}/api/products/${id}` : `${API_BASE}/api/products`;
        const method = id ? 'PUT' : 'POST';
        
        const response = await fetch(url, {
          method,
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        if (response.ok) {
          alert(id ? 'Product updated' : 'Product added');
          closeProductModal();
          loadProducts();
        }
      } catch (error) {
        console.error('Error:', error);
      }
    });

    // Customers
    async function loadCustomers() {
      try {
        const search = document.getElementById('customer-search').value;
        const url = search ? `${API_BASE}/api/customers?q=${encodeURIComponent(search)}` : `${API_BASE}/api/customers`;
        const customers = await fetch(url).then(r => r.json());
        
        const container = document.getElementById('customers-table');
        if (customers.length === 0) {
          container.innerHTML = '<div class="empty-state"><p>No customers found</p></div>';
          return;
        }
        
        container.innerHTML = `
          <table class="data-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Loyalty Points</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              ${customers.map(c => `
                <tr>
                  <td><strong>${c.name}</strong></td>
                  <td>${c.email || 'N/A'}</td>
                  <td>${c.phone || 'N/A'}</td>
                  <td>${c.loyalty_points || 0}</td>
                  <td>
                    <div class="action-btns">
                      <button class="btn btn-warning" onclick='editCustomer(${JSON.stringify(c)})'>Edit</button>
                      <button class="btn btn-danger" onclick="deleteCustomer('${c.id}')">Delete</button>
                    </div>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;
      } catch (error) {
        console.error('Error loading customers:', error);
      }
    }

    function openCustomerModal(customer = null) {
      const modal = document.getElementById('customer-modal');
      const title = document.getElementById('customer-modal-title');
      
      if (customer) {
        title.textContent = 'Edit Customer';
        document.getElementById('customer-id').value = customer.id;
        document.getElementById('customer-name').value = customer.name;
        document.getElementById('customer-email').value = customer.email || '';
        document.getElementById('customer-phone').value = customer.phone || '';
        document.getElementById('customer-points').value = customer.loyalty_points || 0;
      } else {
        title.textContent = 'Add New Customer';
        document.getElementById('customer-form').reset();
        document.getElementById('customer-id').value = '';
      }
      
      modal.classList.add('active');
    }

    function closeCustomerModal() {
      document.getElementById('customer-modal').classList.remove('active');
    }

    function editCustomer(customer) {
      openCustomerModal(customer);
    }

    async function deleteCustomer(id) {
      if (!confirm('Are you sure?')) return;
      
      try {
        const response = await fetch(`${API_BASE}/api/customers/${id}`, { method: 'DELETE' });
        if (response.ok) {
          alert('Customer deleted');
          loadCustomers();
        }
      } catch (error) {
        console.error('Error:', error);
      }
    }

    document.getElementById('customer-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const id = document.getElementById('customer-id').value;
      const data = {
        name: document.getElementById('customer-name').value,
        email: document.getElementById('customer-email').value,
        phone: document.getElementById('customer-phone').value,
        loyalty_points: parseInt(document.getElementById('customer-points').value) || 0
      };
      
      try {
        const url = id ? `${API_BASE}/api/customers/${id}` : `${API_BASE}/api/customers`;
        const method = id ? 'PUT' : 'POST';
        
        const response = await fetch(url, {
          method,
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        if (response.ok) {
          alert(id ? 'Customer updated' : 'Customer added');
          closeCustomerModal();
          loadCustomers();
        }
      } catch (error) {
        console.error('Error:', error);
      }
    });

    // Messages
    async function loadMessages() {
      try {
        const search = document.getElementById('message-search').value;
        const url = search ? `${API_BASE}/api/messages?q=${encodeURIComponent(search)}` : `${API_BASE}/api/messages`;
        const messages = await fetch(url).then(r => r.json());
        
        const container = document.getElementById('messages-table');
        if (messages.length === 0) {
          container.innerHTML = '<div class="empty-state"><p>No messages found</p></div>';
          return;
        }
        
        container.innerHTML = `
          <table class="data-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Name</th>
                <th>Contact</th>
                <th>Message</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              ${messages.map(m => `
                <tr>
                  <td>${new Date(m.date_sent).toLocaleDateString()}</td>
                  <td><strong>${m.name}</strong></td>
                  <td>${m.email || m.phone || 'N/A'}</td>
                  <td>${m.message ? m.message.substring(0, 100) + '...' : 'N/A'}</td>
                  <td>
                    <button class="btn btn-danger" onclick="deleteMessage('${m.id}')">Delete</button>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;
      } catch (error) {
        console.error('Error loading messages:', error);
      }
    }

    async function deleteMessage(id) {
      if (!confirm('Delete this message?')) return;
      
      try {
        const response = await fetch(`${API_BASE}/api/messages/${id}`, { method: 'DELETE' });
        if (response.ok) {
          alert('Message deleted');
          loadMessages();
        }
      } catch (error) {
        console.error('Error:', error);
      }
    }

    // Search
    document.getElementById('product-search').addEventListener('input', loadProducts);
    document.getElementById('customer-search').addEventListener('input', loadCustomers);
    document.getElementById('message-search').addEventListener('input', loadMessages);

    // Close modals on outside click
    document.querySelectorAll('.modal').forEach(modal => {
      modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.classList.remove('active');
      });
    });

    // Load dashboard on start
    loadDashboard();
  </script>

  <!-- FOOTER -->
  <footer>
    <div class="container">
      <p style="text-align:center;">¬© 2025 Brew Haven Coffee Shop. All rights reserved.</p>
    </div>
  </footer>
</body>
</html>